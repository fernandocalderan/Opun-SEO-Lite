services:
  backend:
    build:
      context: ./backend
    image: opun-backend:local
    container_name: opun-backend
    environment:
      - NODE_ENV=production
      - PORT=3333
      - NODE_OPTIONS=--experimental-specifier-resolution=node
    ports:
      - "3333:3333"
    volumes:
      - opun_backend_data:/app/.data
    restart: unless-stopped

  worker:
    build:
      context: ./backend
    image: opun-backend:local
    container_name: opun-backend-worker
    command: ["node", "--enable-source-maps", "--no-warnings", "--import", "tsx", "src/worker.ts"]
    environment:
      - NODE_ENV=production
      - NODE_OPTIONS=
    depends_on:
      - backend
    volumes:
      - opun_backend_data:/app/.data
    restart: unless-stopped

volumes:
  opun_backend_data:
